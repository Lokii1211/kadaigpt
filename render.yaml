# KadaiGPT - Render.com Deployment
# render.yaml - Infrastructure as Code (Blueprint)
# This file auto-configures all services when you connect to Render

services:
  # ── Main Backend + Frontend (FastAPI serves React build) ──
  - type: web
    name: kadaigpt
    runtime: docker
    dockerfilePath: ./Dockerfile
    region: singapore  # Closest to India
    plan: free
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: kadaigpt-db
          property: connectionString
      - key: APP_ENV
        value: production
      - key: SECRET_KEY
        generateValue: true
      - key: JWT_SECRET_KEY
        generateValue: true
      - key: GOOGLE_API_KEY
        sync: false  # Set manually in dashboard
      - key: TELEGRAM_BOT_TOKEN
        sync: false
      - key: ENCRYPTION_KEY
        sync: false
      - key: PORT
        value: "8000"
      - key: RENDER_EXTERNAL_URL
        value: "https://kadaigpt.onrender.com"
    healthCheckPath: /api/health

  # ── WhatsApp Baileys Bot (Persistent Process) ──
  - type: web
    name: kadaigpt-whatsapp
    runtime: docker
    rootDir: whatsapp-gateway
    dockerfilePath: ./Dockerfile
    region: singapore
    plan: free
    envVars:
      - key: KADAIGPT_BACKEND_URL
        value: https://kadaigpt.onrender.com
      - key: PORT
        value: "3001"

# ── PostgreSQL Database ──
databases:
  - name: kadaigpt-db
    plan: free
    region: singapore
    databaseName: kadaigpt
    user: kadaigpt_user
